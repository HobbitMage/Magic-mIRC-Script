[aliases]
n0=;vizu
n1=proc.load {
n2=  echo %colors.system -sta $st.color(Magic Script) is loading
n3=  if ($fopen(file)) { .fclose file }
n4=  unset %colors.*
n5=  unset %str.*
n6=  unset %files.*
n7=  var %t = 0, %setup = strings/setup.ini
n8=  .timerload -mh 0 1  inc %t
n9=  var %i = 1, %j = 1, %n = $ini(%setup,0), %tmp, %namen, %name, %namep, %pre
n10=  while (%i <= %n) {
n11=    %name = $ini(%setup,%i)
n12=    %namen = $ini(%setup,%i,0)
n13=    while (%j <= %namen) { 
n14=      %namep = $ini(%setup,%i,%j)
n15=      set -n %tmp $readini(%setup,n,%name,%namep)
n16=      if ($left(%tmp,1) == $chr(127)) set -n %tmp $right(%tmp,-1)
n17=      if (%name == user) { if (%tmp != $null) {
n18=          if (%namep == nick) if (!$away) nick %tmp
n19=          if (%namep == anick) .anick %tmp
n20=          if (%namep == timestamp) .timestamp -f %tmp
n21=          if (!$istok(nick timestamp anick,%namep,32)) set -n % [ $+ [ %namep ] ] %tmp
n22=      } }
n23=      else if (%tmp != $null) set -n % [ $+ [ %name ] $+ . $+ [ %namep ] ] %tmp 
n24=      inc %j 
n25=    }
n26=    %j = 1
n27=    inc %i
n28=  }
n29=  set %i 0
n30=  var %theme = $readini(mirc.ini,text,theme)
n31=  while (%i < $ini(mirc.ini,colors,0)) {
n32=    set %tmp $readini(mirc.ini,colors,n $+ %i)
n33=    if ($gettok(%tmp,1,44) == %theme) { break }
n34=    inc %i
n35=  }
n36=  set %colors.back $str(0,$calc(2 - $len($gettok(%tmp,2,44)))) $+ $gettok(%tmp,2,44)
n37=  set %colors.action $str(0,$calc(2 - $len($gettok(%tmp,3,44)))) $+ $gettok(%tmp,3,44)
n38=  set %colors.ctcp $str(0,$calc(2 - $len($gettok(%tmp,4,44)))) $+ $gettok(%tmp,4,44)
n39=  set %colors.highlight $str(0,$calc(2 - $len($gettok(%tmp,5,44)))) $+ $gettok(%tmp,5,44)
n40=  set %colors.info $str(0,$calc(2 - $len($gettok(%tmp,6,44)))) $+ $gettok(%tmp,6,44)
n41=  set %colors.info2 $str(0,$calc(2 - $len($gettok(%tmp,7,44)))) $+ $gettok(%tmp,7,44)
n42=  set %colors.invite $str(0,$calc(2 - $len($gettok(%tmp,8,44)))) $+ $gettok(%tmp,8,44)
n43=  set %colors.join $str(0,$calc(2 - $len($gettok(%tmp,9,44)))) $+ $gettok(%tmp,9,44)
n44=  set %colors.kick $str(0,$calc(2 - $len($gettok(%tmp,10,44)))) $+ $gettok(%tmp,10,44)
n45=  set %colors.mode $str(0,$calc(2 - $len($gettok(%tmp,11,44)))) $+ $gettok(%tmp,11,44)
n46=  set %colors.nick $str(0,$calc(2 - $len($gettok(%tmp,12,44)))) $+ $gettok(%tmp,12,44)
n47=  set %colors.normal $str(0,$calc(2 - $len($gettok(%tmp,13,44)))) $+ $gettok(%tmp,13,44)
n48=  set %colors.notice $str(0,$calc(2 - $len($gettok(%tmp,14,44)))) $+ $gettok(%tmp,14,44)
n49=  set %colors.notify $str(0,$calc(2 - $len($gettok(%tmp,15,44)))) $+ $gettok(%tmp,15,44)
n50=  set %colors.other $str(0,$calc(2 - $len($gettok(%tmp,16,44)))) $+ $gettok(%tmp,16,44)
n51=  set %colors.own $str(0,$calc(2 - $len($gettok(%tmp,17,44)))) $+ $gettok(%tmp,17,44)
n52=  set %colors.part $str(0,$calc(2 - $len($gettok(%tmp,18,44)))) $+ $gettok(%tmp,18,44)
n53=  set %colors.quit $str(0,$calc(2 - $len($gettok(%tmp,19,44)))) $+ $gettok(%tmp,19,44)
n54=  set %colors.topic $str(0,$calc(2 - $len($gettok(%tmp,20,44)))) $+ $gettok(%tmp,20,44)
n55=  set %colors.wallops $str(0,$calc(2 - $len($gettok(%tmp,21,44)))) $+ $gettok(%tmp,21,44)
n56=  set %colors.whois $str(0,$calc(2 - $len($gettok(%tmp,22,44)))) $+ $gettok(%tmp,22,44)
n57=  set %colors.edit.back $str(0,$calc(2 - $len($gettok(%tmp,23,44)))) $+ $gettok(%tmp,23,44)
n58=  set %colors.edit.text $str(0,$calc(2 - $len($gettok(%tmp,24,44)))) $+ $gettok(%tmp,24,44)
n59=  set %colors.list.back $str(0,$calc(2 - $len($gettok(%tmp,25,44)))) $+ $gettok(%tmp,25,44)
n60=  set %colors.list.text $str(0,$calc(2 - $len($gettok(%tmp,26,44)))) $+ $gettok(%tmp,26,44)
n61=  set %colors.list.gray $str(0,$calc(2 - $len($gettok(%tmp,27,44)))) $+ $gettok(%tmp,27,44)
n62=  set %colors.list.title $str(0,$calc(2 - $len($gettok(%tmp,28,44)))) $+ $gettok(%tmp,28,44)
n63=  set %colors.edit.inactive $str(0,$calc(2 - $len($gettok(%tmp,29,44)))) $+ $gettok(%tmp,29,44)
n64=
n65=  unset %isaway_*
n66=  ;files
n67=  ;nicks
n68=  %i = 1
n69=  .fopen file strings/nicks.txt
n70=  while (%i <= $lines(strings/nicks.txt)) {
n71=    if ($feof) { fclose file | break }
n72=    %files.nick. [ $+ [ %i ] ] = $fread(file)
n73=    inc %i
n74=  }
n75=  %files.nick.num = %i
n76=  if ($fopen(file)) { .fclose file }
n77=  ;away
n78=  %i = 1
n79=  .fopen file strings/away.txt
n80=  while (%i <= $lines(strings/away.txt)) {
n81=    if ($feof) { fclose file | break }
n82=    %files.away. [ $+ [ %i ] ] = $fread(file)
n83=    inc %i
n84=  }
n85=  %files.away.num = %i
n86=  if ($fopen(file)) { .fclose file }
n87=  ;channels
n88=  %i = 1
n89=  .fopen file strings/channels.txt
n90=  while (%i <= $lines(strings/channels.txt)) {
n91=    if ($feof) { fclose file | break }
n92=    %files.join. [ $+ [ %i ] ] = $fread(file)
n93=    inc %i
n94=  }
n95=  %files.join.num = %i
n96=  if ($fopen(file)) { .fclose file }
n97=  ;quit
n98=  %i = 1
n99=  .fopen file strings/quit.txt
n100=  while (%i <= $lines(strings/quit.txt)) {
n101=    if ($feof) { fclose file | break }
n102=    %files.quit. [ $+ [ %i ] ] = $fread(file)
n103=    inc %i
n104=  }
n105=  %files.quit.num = %i
n106=  if ($fopen(file)) { .fclose file }
n107=  ;kick
n108=  %i = 1
n109=  .fopen file strings/kick.txt
n110=  while (%i <= $lines(strings/kick.txt)) {
n111=    if ($feof) { fclose file | break }
n112=    %files.kick. [ $+ [ %i ] ] = $fread(file)
n113=    inc %i
n114=  }
n115=  %files.kick.num = %i
n116=  if ($fopen(file)) { .fclose file }
n117=  ;ctcp
n118=  %i = 1
n119=  .fopen file strings/ctcp.txt
n120=  while (%i <= $lines(strings/ctcp.txt)) {
n121=    if ($feof) { fclose file | break }
n122=    %files.ctcp. [ $+ [ %i ] ] = $fread(file)
n123=    inc %i
n124=  }
n125=  %files.ctcp.num = %i
n126=  if ($fopen(file)) { .fclose file }
n127=  ;kick
n128=  %i = 1
n129=  .fopen file strings/kick.txt
n130=  while (%i <= $lines(strings/kick.txt)) {
n131=    if ($feof) { fclose file | break }
n132=    %files.kick. [ $+ [ %i ] ] = $fread(file)
n133=    inc %i
n134=  }
n135=  %files.kick.num = %i
n136=  if ($fopen(file)) { .fclose file }
n137=  ;files
n138=  %i = 1
n139=  .fopen file strings/files.txt
n140=  while (%i <= $lines(strings/files.txt)) {
n141=    if ($feof) { fclose file | break }
n142=    %files.files. [ $+ [ %i ] ] = $fread(file)
n143=    inc %i
n144=  }
n145=  %files.files.num = %i
n146=  if ($fopen(file)) { .fclose file }
n147=  ;services
n148=  %i = 1
n149=  echo %colors.system -sta $st.color(Magic Script) Ready in %t ms
n150=  .timerload off
n151=}
n152=
n153=proc.start {
n154=  proc.load
n155=  window -ek0mxzn @Сервисы // $+ $netget(nickserv.call)
n156=  if (%prefs.clock) {   
n157=    if ($dialog(clock)) dialog -vs clock $iif(%prefs.clock.xy,$ifmatch,-1 -1) $dialog(clock).cw $dialog(clock).ch
n158=    else dialog $iif(%prefs.clock.window,-mdo,-m) clock clock 
n159=  }
n160=  if (%prefs.help.autostart) help.show sys
n161=  if (%prefs.multiserver) {
n162=    if ($numtok(%prefs.servers,32) > 1) {
n163=      server $gettok(%prefs.servers,1,32)
n164=      %i = 2
n165=      while (%i <= $numtok(%prefs.servers,32)) {
n166=        server -m $gettok(%prefs.servers,%i,32)
n167=        inc %i
n168=      }
n169=    }
n170=  }
n171=}
n172=
n173=proc.save { 
n174=  echo %colors.system -at Сохранение переменных
n175=  var %setup = strings\setup.ini
n176=  .copy -o %setup %setup $+ .bak
n177=  var %i = 1, %j = 1, %n = $ini(%setup,0), %tmp, %namen, %name, %namep, %pre
n178=  while (%i <= %n) {
n179=    %name = $ini(%setup,%i)
n180=    %namen = $ini(%setup,%i,0)
n181=    while (%j <= %namen) { 
n182=      %namep = $ini(%setup,%i,%j)
n183=      if (%name == user) {
n184=        if (%namep == anick) writeini %setup user anick $anick
n185=        if (%namep == timestamp) writeini %setup user timestamp $timestampfmt
n186=        if (!$istok(nick timestamp anick,%namep,32)) writeini %setup user %namep [ % $+ [ %namep ] ]
n187=      }
n188=      else {
n189=        set -n %tmp [ % [ $+ [ %name ] $+ . $+ [ %namep ] ] ]
n190=        if ($istok(2 3 22 31,$asc($left(%tmp,1)),32)) set -n %tmp $chr(127) $+ %tmp
n191=        if (%tmp != $null) mwriteini %setup %name %namep %tmp 
n192=      }
n193=      inc %j 
n194=    }
n195=    %j = 1
n196=    inc %i
n197=  }
n198=  echo %colors.system -at Сохранение переменных завершено
n199=  return
n200=  :error
n201=  echo %colors.system -at Ошибка сохранения переменных. Сохраните еще раз.
n202=  .timer 1 1 .copy -o %setup $+ .bak %setup
n203=}
n204=
n205=
n206=proc.connect {
n207=  unset %isaway_*_ [ $+ [ $server ] ]
n208=  ;-----------------------------
n209=  var %i = 1
n210=  while (%i <= $lines(strings/perform.txt)) {
n211=    var %str = $read(strings/perform.txt,%i)
n212=    var %targ = $gettok(%str,1,32)
n213=    set %str $gettok(%str,2-,32)
n214=    if (%targ == all) { [ [ %str ] ] | goto end }
n215=    if (%targ == $network) { [ [ %str ] ] | goto end }
n216=    if (%targ == $server) { [ [ %str ] ] | goto end }
n217=    :end
n218=    inc %i
n219=  }
n220=  ;-----------------------------  
n221=}
n222=proc.disconnect {
n223=  unset %isaway_*_ [ $+ [ $server ] ]
n224=}
n225=proc.exit {
n226=  unset %isaway_*
n227=}
n228=
n229=chnick {
n230=  var %str 
n231=  if ($1 == $me) { set %str %str $+ %colors.mynick | goto cvend }
n232=  if ($isdown($1)) { set %str %str $+ %colors.downnick | goto cvend }
n233=  if ($isbot($1)) { set %str %str $+ %colors.botnick | goto cvend }
n234=  set %str %str $+ %colors.nick
n235=  :cvend
n236=  set %str %str $+ $1 $+ 
n237=  return %str
n238=}
n239=
n240=mwriteini {
n241=  var %i = 1, %str, %tmp
n242=  %tmp = $read($1,s,$chr(91) $+ $2 $+ $chr(93))
n243=  %str = $readn
n244=  %i = %str + 1
n245=  while ([*] !iswm %tmp) {
n246=    set -n %tmp $read($1,n,%i)
n247=    if ([*] iswm %tmp) { write -il $+ %i $1 $3 $+ = $+ $4- | return }
n248=    if ($gettok(%tmp,1,61) == $3) { write -l $+ %i $1 $3 $+ = $+ $4- | return }
n249=    inc %i
n250=  }
n251=}
n252=random { return [ $ $+ [ $rand(1,$0) ] ] } 
n253=неори say $snicks $+ : http://www.dan78.pri.ee/pe4ati/11.gif
